# 第八节 哨兵挂了还能提供主从切换服务吗



先提供答案，如果没有配置哨兵集群，肯定不能主从切换了；如果提供了哨兵集群，如果挂掉的哨兵实例大于总哨兵数量的一半，也不能主从切换。

从上节，哨兵是通过投票判断主库是否下线，当投票数量大于配置的quorum后，该主库被认为客观下线；

这时集群需要选举出一个leader哨兵主导主从切换，选举也是通过投票方式，每个哨兵仅可以投一票，可以投给自己；

通常当哨兵判断主库客观下线后，会给自己投一票，然后通知其他哨兵投票，如果哨兵没给自己投票，它会给第一个发送投票请求的哨兵投票，当获得的投票数超过哨兵实例的一半时，被选举称为 leader，主导主从切换。

当多个哨兵实例都发起投票，但都没达到哨兵实例一半，就是选举失败，哨兵会在稍后重新发起投票

如果哨兵实例只有2个，挂掉一个实例，也无法主从切换，这时必须满足得票2

举例：

哨兵集群实例实例5，配置quorum=2，当三个哨兵实例故障，当主库宕机；因为满足quorum=2即可，因此可以判断主库客观下线，但是由于无法满足得票 5/2=3，因此无法选出leader，无法进行主从切换。

因为哨兵投票机制和选举机制，当哨兵集群实例过多时，导致选举时间长，主从切换时间长，因此不是越多越好；