# Kafka学习 | Q&A

### Topic 为什么要分区？



### kafka节点之间是如何备份的?



### 多分区消费如何做到顺序一致?

哪些情况会乱序？

1、未启用幂等性情况下，生产者消息重试发送导致乱序

2、多分区多消费者情况下，消息消费会乱序

解决方案：

1、启用幂等型生产者发送消息，幂等生产者和Broker维护了一个自增的id，消息发送成功后会自增，当broker发现该自增ID大于维护的才会接收消息

2、消息发送根据消息类型指定key，具有顺序要求的一类消息发送到同一分区，由于一个分区只能被一个消费者订阅，分区内的消息是保证顺序的；

这种情况如果新增分区，会导致重平衡，这种情况一是设置重平衡分区分配策略，如果是2.4版本后设置分区策略为协作再平衡策略，该策略分区分配同一分配，会尽量避免消费中分区被分配给其他消费者；二是在消费程序中做判断（与DB），当信息状态不一致，就将消息重新发回队列中，等待重新消费。

3、多生产者发送消息，这种情况即使一类消息发送同一分区，也无法保证有序，只能在消费者中与DB判断，不一致时重新写回。

### 消费者重平衡是什么？

[Kafka学习-重平衡](https://github.com/liuweime/note/blob/master/消息队列/Kafka/Kafka学习-重平衡.md)

### kafka消息是否会丢失？为什么？出现消息丢失的原因是什么？

[Kafka学习-如何保证消息不丢失](https://github.com/liuweime/note/blob/master/消息队列/Kafka/Kafka学习-如何保证消息不丢失.md)

### 如何合理配置Kafka？对硬件的要求是什么？

[Kafka学习-如何合理配置Kafka](https://github.com/liuweime/note/blob/master/消息队列/Kafka/Kafka学习-如何合理配置Kafka.md) 


### kafka leader的选举机制是什么？








