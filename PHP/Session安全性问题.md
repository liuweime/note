# Session安全性问题



## Cookie 劫持

我们知道，HTTP 协议是一种无状态的协议，因此使用 Session 来标识用户、记录用户的状态。 Session 由服务端产生，并将 Session ID 记录在 Cookie 中，在每次请求中存于 Header 头中发向服务端。

由上描述可知，服务端找到用户状态的关键在于 Session ID，而不关心持有 Session ID 是不是该用户，这就给 Session 劫持制造了条件。劫持就是通过某种手段来窃取到用户的Session ID，劫持之后它可以接管整个会话，而Session ID存储在 Cookie 中，因此劫持了 Cookie 就能达到窃取Session的目的。

 通常窃取Session 可以使用如下方式：

- 如果 Session ID 是非随机的，那么可以通过猜测方式
- 如果 Session ID 是随机的，但位数较短，可以采用暴力破解的方式
- 通过 XSS、中间人等方式窃取 Session ID

### XSS 方式

XSS 就是常说的跨站脚本攻击，将一段JavaScript脚本存到有XSS漏洞的站点，用户打开该页面时，该段JavaScript脚本就会起作用。这种方式获取Session ID也有多种方式。

常见的是通过JSONP跨域请求另一个服务器，将读取到的用户Cookie发送到该服务器。该种方式缺点是如果用户点击退出按钮，那么窃取的Session就无效了。

因此，有了更进一步的方式，在前者的基础上，获取到 Cookie 后将原来的Cookie删除或置空，此时服务端未读取到Session ID，就会让用户登录，重新产生了一个Session ID，而前一个Session ID因为没有主动触发退出动作而未被销毁可以长久使用。

### 中间人攻击

中间人攻击是指攻击者在客户端和服务端之间同时建立了联系，而不被两者识破。达成中间人攻击后，所有流过中间端的数据都可能被中间人监听、窃取、修改。

攻击方式主要为：

- 完成中间人攻击，挟持流量
- 利用抓包工具抓取流量，并对流量进行分析，获取到Cookie数据
- 将读取的数据重组，对目标网站重放，使用被挟持用户的身份登录网站

## Session 固定

